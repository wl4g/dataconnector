# Copyright (c) 2017 ~ 2025, the original author James Wong individual Inc,
# All rights reserved. Contact us <jameswong1376@gmail.com>
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# #### Environment Base configuration. ####
#

spring:
  application.name: kafka-subscriber
  main:
    allow-circular-references: true

server:
  port: 8000
  servlet:
    contextPath: /

kafka-subscriber:
  bases:
    consumerProps: &baseConsumerProps
      request.timeout.ms: 30000
      auto.offset.reset: earliest
    processProps: &baseProcessProps
      sharedExecutorThreadPoolSize: 50
      sharedExecutorQueueSize: 500
      sequenceExecutorsMaxCountLimit: 100
      sequenceExecutorsPerQueueSize: 100
      executorWarmUp: true
      checkpointQoS: 2 # 0:AT_MOST_ONCE|1:RETRIES_AT_MOST|2:RETRIES_AT_MOST_STRICTLY|3:STRICTLY
      checkpointQoSMaxRetries: 5
      checkpointQoSMaxRetriesTimeout: 6h
      checkpointProducerMaxCountLimit: 100

  pipelines:
    - source:
        topicPattern: "test-input"
        parallelism: 2
        matchToSubscriberUpdateDelayTime: 3s
        consumerProps:
          bootstrap.servers: "localhost:9092"
          group.id: "shared_source_1112211"
          <<: *baseConsumerProps
      filter:
        topicPrefix: "shared_filtered_"
        customFilterBeanName: defaultRecordMatchSubscribeFilter # By default: defaultRecordMatchSubscribeFilter
        processProps:
          <<: *baseProcessProps
        producerProps:
          bootstrap.servers: "localhost:9092"
          acks: 0
          request.timeout.ms: 30000
          max.request.size: 1048576
          send.buffer.bytes: 131072
          retries: 5
          retry.backoff.ms: 6000
          compression.type: gzip
      sink:
        enable: true
        groupIdPrefix: "isolation_sink_"
        customSinkBeanName: defaultSubscribeSink # By default: defaultSubscribeSink
        parallelism: 2
        consumerProps:
          bootstrap.servers: "localhost:9092"
          #group.id:
          <<: *baseConsumerProps
        processProps:
          <<: *baseProcessProps

  subscribers:
    - id: 54321
      name: "subscriber_0"
      enable: true
      isSequence: false
      properties:
        defaultRecordMatchSubscribeFilter: '{"type":"RELATION","name":"testCondition1","fn":{"expression":"a >= 1 && b <= 2"}}'
