# Copyright (c) 2017 ~ 2025, the original author James Wong individual Inc,
# All rights reserved. Contact us James Wrong James Wong<jamewong1376@gmail.com>
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

version: "3"

networks:
  subscriber_net:
    driver: bridge

services:
  zookeeper01:
    image: registry.cn-shenzhen.aliyuncs.com/wl4g-k8s/bitnami_zookeeper:3.6.2 # docker.io/bitnami/zookeeper:3.6.2
    container_name: zookeeper01
    hostname: zookeeper01
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes
    restart: unless-stopped
    networks:
      - subscriber_net
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
      - zookeeper_data:/opt/bitnami/zookeeper/data:rw
    ports:
      - 12181:2181

  kafka01: ## see:https://raw.githubusercontent.com/bitnami/containers/main/bitnami/kafka/docker-compose.yml
    image: registry.cn-shenzhen.aliyuncs.com/wl4g-k8s/bitnami_kafka:2.2.0 # docker.io/bitnami/kafka:2.2.0
    container_name: kafka01
    hostname: kafka01
    environment:
      - ALLOW_PLAINTEXT_LISTENER=yes
      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper01:2181
    restart: unless-stopped
    networks:
      - subscriber_net
    depends_on:
      - zookeeper01
    ## see:https://hub.docker.com/r/bitnami/kafka/#Persisting_your_data
    #user: 1001:1000
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
      #- kafka_data:/bitnami/kafka/data:rw
    ports:
      - 19092:9092

  zookeeper02:
    image: registry.cn-shenzhen.aliyuncs.com/wl4g-k8s/bitnami_zookeeper:3.6.2 # docker.io/bitnami/zookeeper:3.6.2
    container_name: zookeeper02
    hostname: zookeeper02
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes
    restart: unless-stopped
    networks:
      - subscriber_net
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
      - zookeeper_data:/opt/bitnami/zookeeper/data:rw
    ports:
      - 22181:2181

  kafka02: ## see:https://raw.githubusercontent.com/bitnami/containers/main/bitnami/kafka/docker-compose.yml
    image: registry.cn-shenzhen.aliyuncs.com/wl4g-k8s/bitnami_kafka:2.2.0 # docker.io/bitnami/kafka:2.2.0
    container_name: kafka02
    hostname: kafka02
    environment:
      - ALLOW_PLAINTEXT_LISTENER=yes
      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper02:2181
    restart: unless-stopped
    networks:
      - subscriber_net
    depends_on:
      - zookeeper02
    ## see:https://hub.docker.com/r/bitnami/kafka/#Persisting_your_data
    #user: 1001:1000
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
      #- kafka_data:/bitnami/kafka/data:rw
    ports:
      - 29092:9092

  ## see:https://github.com/provectus/kafka-ui/blob/v0.7.1/documentation/compose/kafka-ui.yaml
  kafka_ui:
    image: registry.cn-shenzhen.aliyuncs.com/wl4g-k8s/provectuslabs_kafka-ui:v0.7.1 # docker.io/provectuslabs/kafka-ui:v0.7.1
    container_name: kafka_ui
    hostname: kafka_ui
    environment:
      - JAVA_OPTS=-Djava.net.preferIPv4Stack=true -Xmx1G
      - KAFKA_CLUSTERS_0_NAME=dev-kafka01
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka01:9092
      - KAFKA_CLUSTERS_1_NAME=dev-kafka02
      - KAFKA_CLUSTERS_1_BOOTSTRAPSERVERS=kafka02:9092
      #- KAFKA_CLUSTERS_0_METRICS_PORT=9997
      #- KAFKA_CLUSTERS_0_SCHEMAREGISTRY=http://schemaregistry0:8085
      #- KAFKA_CLUSTERS_0_KAFKACONNECT_0_NAME=first
      #- KAFKA_CLUSTERS_0_KAFKACONNECT_0_ADDRESS=http://kafka-connect0:8083
    restart: unless-stopped
    networks:
      - subscriber_net
    depends_on:
      - zookeeper01
      - kafka01
      - zookeeper02
      - kafka02
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - 38080:8080

#  kafka-subscriber:
#    image: docker.io/wl4g/kafka-subscriber:1.0.0
#    container_name: kafka-subscriber
#    hostname: kafka-subscriber
#    restart: unless-stopped
#    networks:
#      - subscriber_net
#    depends_on:
#      - zookeeper
#      - kafka
#    volumes:
#      - /etc/timezone:/etc/timezone:ro
#      - /etc/localtime:/etc/localtime:ro
#    ports:
#      - 8000:8000

volumes:
  zookeeper_data:
    driver: local
  kafka_data:
    driver: local
